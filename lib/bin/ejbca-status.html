<script type="text/html" data-template-name="ejbca-status">

  <div class="form-row">
    <label for="node-input-name">
      <i class="fa fa-tag"></i> Name
    </label>
    <input type="text" id="node-input-name" placeholder="">
  </div>

  <div class="form-row">
    <label for="node-input-url">
      <i class="fa fa-link"></i> URL
    </label>
    <input type="text" id="node-input-url" placeholder="https://localhost:8443/ejbca">
  </div>

  <div class="form-row">
    <input type="checkbox" id="node-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-input-usetls" style="width: auto">Enable secure (SSL/TLS) connection</label>
    <div id="node-row-tls" class="hide">
      <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-input-tls">
        TLS Configuration
      </label>
      <input type="text" style="width: 300px" id="node-input-tls">
    </div>
  </div>
</script>

<script type="text/javascript">
    (function () {
        RED.nodes.registerType('ejbca-status', {
            category: 'EJBCA',
            color: "rgb(231, 231, 174)",
            defaults: {
                name: {value: ""},
                url: {
                    value: "",
                    validate: function (v, opt) {
                        if ((v.trim().length === 0) ||
                            (v.indexOf("://") === -1) ||
                            (v.trim().indexOf("http") === 0)) {
                            return true;
                        }
                        return RED._("node-red:httpin.errors.invalid-url");
                    }
                },
                tls: {
                    type: "tls-config", required: false,
                    label: RED._("node-red:httpin.tls-config")
                },
            },
            inputs: 1,
            outputs: 1,
            icon: "white-globe.svg",
            label: function () {
                return this.name || this._("ejbca-status");
            },
            labelStyle: function () {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function () {
                const node = this;

                function updateTLSOptions() {
                    if ($("#node-input-usetls").is(':checked')) {
                        $("#node-row-tls").show();
                    } else {
                        $("#node-row-tls").hide();
                    }
                    RED.tray.resize();
                }

                if (node.tls) {
                    $('#node-input-usetls').prop('checked', true);
                } else {
                    $('#node-input-usetls').prop('checked', false);
                }
                updateTLSOptions();
                $("#node-input-usetls").on("click", function () {
                    updateTLSOptions();
                });


            },
            oneditsave: function () {
                if (!$("#node-input-usetls").is(':checked')) {
                    $("#node-input-tls").val("_ADD_");
                }
            },
        });
    })();
</script>